{% extends "base.html" %}
{% block title %}TirGoPharma · Menú{% endblock %}

{% block content %}
<section class="grid">
  <article class="card">
    <h3>Consultar</h3>
    <p class="muted">Identifícate y verás tus medicamentos permitidos para recoger.</p>
    <a class="btn primary" href="{{ url_for('consultar.consultar') }}">Entrar</a>
  </article>

  <article class="card">
    <h3>Leer</h3>
    <p class="muted">Pide un medicamento. Si no es tipo R y hay stock, te lo llevo directo.</p>
    <a class="btn primary" href="{{ url_for('leer.leer') }}">Entrar</a>
  </article>

  <article class="card">
    <h3>Diagnóstico</h3>
    <p class="muted">Test guiado. Si la mejor opción es tipo R, te avisaré para que visites al médico.</p>
    <a class="btn primary" href="{{ url_for('diagnostico.diagnostico') }}">Entrar</a>
  </article>
</section>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
(function(){
  async function pollNav(){
    try{
      const r = await fetch('/voice_nav', {cache:'no-store'});
      const j = await r.json();
      const nav = (j.nav || '').toLowerCase();
      if (nav){
        if (nav === 'consultar') {
          window.location.href = "{{ url_for('consultar.consultar') }}";
          return;
        }
        if (nav === 'leer') {
          window.location.href = "{{ url_for('leer.leer') }}";
          return;
        }
        if (nav === 'diagnostico') {
          window.location.href = "{{ url_for('diagnostico.diagnostico') }}";
          return;
        }
      }
    } catch(e){}
    setTimeout(pollNav, 700);
  }
  pollNav();
})();
</script>
{% endblock %}
