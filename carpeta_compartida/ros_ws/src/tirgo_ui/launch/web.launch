<launch>
  <!-- ============================================================
       TirgoPharma · Lanzador de la web (tirgo_ui)
       ============================================================
       Modo típico (desarrollo):

         roslaunch tirgo_ui web.launch

       Modo “serio” (sin DEV, sin debug Flask, con auth en Mongo):

         roslaunch tirgo_ui web.launch \
           tirgo_dev:=0 \
           flask_debug:=0 \
           flask_secret_key:=cambia-esta-clave \
           mongo_uri:=mongodb://tirgo_app:tirgo@TIAGO_IP:27017/tirgo?authSource=tirgo
       ============================================================ -->

  <!-- ===== Args con defaults orientados a desarrollo ===== -->
  <arg name="port"              default="9001" />
  <arg name="flask_secret_key"  default="dev-secret" />
  <arg name="flask_debug"       default="1" />          <!-- 1 = debug ON, 0 = debug OFF -->
  <arg name="hotword"           default="hola tirgo" />
  <arg name="stt_topic"         default="/stt/text" />
  <arg name="pepper"            default="cambia-esta-cadena-larga" />
  <arg name="tirgo_dev"         default="1" />

  <!-- Con auth (recomendado) -->
  <arg name="mongo_uri"
       default="mongodb://tirgo_app:tirgo@127.0.0.1:27017/tirgo?authSource=tirgo" />

  <!-- Control del servidor de vídeo -->
  <arg name="use_video_server"  default="true" />
  <arg name="video_port"        default="8080" />

  <!-- ===== Exporta las variables de entorno para tirgo_web_server ===== -->
  <env name="PORT"             value="$(arg port)" />
  <env name="FLASK_SECRET_KEY" value="$(arg flask_secret_key)" />
  <env name="FLASK_DEBUG"      value="$(arg flask_debug)" />
  <env name="MONGO_URI"        value="$(arg mongo_uri)" />
  <env name="TIRGO_PEPPER"     value="$(arg pepper)" />
  <env name="TIRGO_DEV"        value="$(arg tirgo_dev)" />
  <env name="TIRGO_HOTWORD"    value="$(arg hotword)" />
  <env name="TIRGO_STT_TOPIC"  value="$(arg stt_topic)" />

  <!-- ===== Nodo principal: servidor web Flask + ROS ===== -->
  <node pkg="tirgo_ui"
        type="tirgo_web_server"
        name="tirgo_web_server"
        output="screen">
    <!-- El script lee las ENV; no hace falta pasar params extra -->
  </node>

  <!-- ===== Servidor de vídeo opcional (cámara TIAGo en el navegador) ===== -->
  <group if="$(arg use_video_server)">
    <node pkg="web_video_server"
          type="web_video_server"
          name="web_video_server"
          output="screen">
      <param name="port" value="$(arg video_port)" />
    </node>
  </group>

</launch>
