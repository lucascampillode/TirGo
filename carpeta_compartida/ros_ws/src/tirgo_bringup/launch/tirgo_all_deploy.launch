<launch>
  <!-- ============================================================
       TirGoPharma · Bringup "ALL" (DEPLOY / NO DEBUG)
       Lanza:
         - STT Vosk
         - Nodo de voz de TIAGo
         - TirgoMissionServer
         - Web tirgo_ui
       Pensado para entorno de despliegue:
         - sin Flask debug
         - sin secretos hardcodeados
         - usando variables de entorno cuando existan
       ============================================================ -->

  <!-- ==========================
       ARGUMENTOS PARA LA WEB
       (mismos que tirgo_ui/web.launch)
       ========================== -->

  <!-- 1 = dev, 0 = despliegue -->
  <arg name="tirgo_dev"        default="0"/>

  <!-- Flask -->
  <!-- Intentamos leer de entorno; si no, ponemos un placeholder no-dev -->
  <arg name="port"             default="$(optenv TIRGO_WEB_PORT 9001)"/>
  <arg name="flask_secret_key" default="$(optenv FLASK_SECRET_KEY cambia-esta-clave-en-.env)"/>
  <arg name="flask_debug"      default="0"/>

  <!-- Seguridad / paciente -->
  <arg name="pepper"           default="$(optenv TIRGO_PEPPER cambia-este-pepper-largo)"/>

  <!-- Voz -->
  <arg name="hotword"          default="$(optenv TIRGO_HOTWORD hola tirgo)"/>
  <arg name="stt_topic"        default="/stt/text"/>

  <!-- Mongo: leer de entorno si está disponible -->
  <arg name="mongo_uri"
       default="$(optenv MONGO_URI mongodb://tirgo_user:CAMBIA_PASS@tirgo_mongo:27017/tirgo?authSource=tirgo)"/>

  <!-- Vídeo (web_video_server) opcional -->
  <arg name="use_video_server" default="$(optenv TIRGO_USE_VIDEO true)"/>
  <arg name="video_port"       default="$(optenv TIRGO_VIDEO_PORT 8080)"/>


  <!-- ==========================
       2) STT Vosk (voz -> texto)
       ========================== -->

  <include file="$(find stt_vosk)/launch/stt_vosk.launch" />
  <!-- Si algún día quieres pasarle args (modelo, micro, etc.)
       puedes añadir <arg ...> aquí y dentro del launch de stt_vosk -->


  <!-- ==========================
       3) Nodo de voz de TIAGo
       ========================== -->

  <node
    pkg="tirgo_mission_server"
    type="tiago_speech_node.py"
    name="tirgo_speech_node"
    output="screen"
  />


  <!-- ==========================
       4) TirgoMissionServer
       ========================== -->

  <node
    pkg="tirgo_mission_server"
    type="tirgo_mission_server.py"
    name="tirgo_mission_server"
    output="screen"
  />


  <!-- ==========================
       5) Web UI (Flask + ROS bridge)
       ========================== -->

  <include file="$(find tirgo_ui)/launch/web.launch">
    <arg name="port"             value="$(arg port)"/>
    <arg name="flask_secret_key" value="$(arg flask_secret_key)"/>
    <arg name="flask_debug"      value="$(arg flask_debug)"/>

    <arg name="hotword"          value="$(arg hotword)"/>
    <arg name="stt_topic"        value="$(arg stt_topic)"/>
    <arg name="pepper"           value="$(arg pepper)"/>

    <arg name="tirgo_dev"        value="$(arg tirgo_dev)"/>
    <arg name="mongo_uri"        value="$(arg mongo_uri)"/>

    <arg name="use_video_server" value="$(arg use_video_server)"/>
    <arg name="video_port"       value="$(arg video_port)"/>
  </include>

</launch>
